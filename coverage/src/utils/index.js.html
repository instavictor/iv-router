<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/utils/index.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">src/utils</a> index.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">2.27% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>1/44</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/4</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">2.33% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>1/43</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">let RouterUtils = {
&nbsp;
  /**
    Extracts the slug i.e. the key of a url.  
    The slug is defined by the text before the first '/' in the URL.
&nbsp;
    e.g. 'home/stuff' - "home" is the slug
    e.g. 'media' - "media" is the slug
    e.g. '/media' - this is invalid
    e.g. '/media/stuff' - this is invalid
  */
  extractSlug(url) {
    let slashIndex = <span class="cstat-no" title="statement not covered" >url.indexOf('/');</span>
    let keyLength = <span class="cstat-no" title="statement not covered" >(slashIndex === -1) ? url.length : slashIndex;</span>
    let slug = <span class="cstat-no" title="statement not covered" >url.substring(0, keyLength) || null;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return slug;</span>
  },
&nbsp;
  /**
    Converts a given route url string to a regular expression
    @return regex of route url
  */
  convertRouteToRegex(route) {
    let escapeRegExp  = <span class="cstat-no" title="statement not covered" >/[\-{}\[\]+?.,\\\^$|#\s]/g;</span>
    let optionalParam = <span class="cstat-no" title="statement not covered" >/\((.*?)\)/g;</span>
    let namedParam    = <span class="cstat-no" title="statement not covered" >/(\(\?)?:\w+/g;</span>
    let splatParam    = <span class="cstat-no" title="statement not covered" >/\*\w+/g;</span>
<span class="cstat-no" title="statement not covered" >    route = route.replace(escapeRegExp, '\\$&amp;')</span>
      .replace(optionalParam, '(?:$1)?')
      .replace(namedParam, <span class="fstat-no" title="function not covered" >(m</span>atch, optional) =&gt; {
<span class="cstat-no" title="statement not covered" >        return optional ? match : '([^/?]+)';</span>
      })
      .replace(splatParam, '([^?]*?)');
<span class="cstat-no" title="statement not covered" >    return new RegExp('^' + route + '(?:\\?([\\s\\S]*))?$');</span>
  },
&nbsp;
  /**
    Parses a route given a partial url.  The route must have a regex attached to it
    to help destruct the url into a keyed JSON object that matches the route definition.
    @param route : the route object to parse for params
    @param urlFragment : the partial URL to parse
    @return JSON that matches the descriptors
  */
  parseParameters(route, urlFragment) {
&nbsp;
    let params = <span class="cstat-no" title="statement not covered" >this.extractParameters(route.regex, urlFragment);</span>
&nbsp;
    // split ids
    let ids = <span class="cstat-no" title="statement not covered" >route.keyDefs.split('/:');</span>
<span class="cstat-no" title="statement not covered" >    if (ids.length &gt; 1) {</span>
<span class="cstat-no" title="statement not covered" >      ids.shift();</span>
    }
&nbsp;
    // assemble JSON object path
    let ret = <span class="cstat-no" title="statement not covered" >{</span>
      query: {}
    };
<span class="cstat-no" title="statement not covered" >    ids.forEach(<span class="fstat-no" title="function not covered" >(i</span>d, i) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >      ret[id] = params[i];</span>
    });
&nbsp;
    // check for any query params
    let queryParams = <span class="cstat-no" title="statement not covered" >params[params.length - 1];</span>
<span class="cstat-no" title="statement not covered" >    if (queryParams) {</span>
      let tmpParams = <span class="cstat-no" title="statement not covered" >queryParams.split('&amp;');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      tmpParams.forEach(<span class="fstat-no" title="function not covered" >(q</span>ueryParam) =&gt; {</span>
        let tmp = <span class="cstat-no" title="statement not covered" >queryParam.split('=');</span>
<span class="cstat-no" title="statement not covered" >        ret.query[tmp[0]] = tmp[1] || '';</span>
      });
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return ret;</span>
  },
&nbsp;
  /**
    Given an array of subroutes and a url,
    call the handler that is to handle the subroute that matches the url
  */
  processRoute(subRoutes, url) {
&nbsp;
    // if no routes exist, then send to 404
<span class="cstat-no" title="statement not covered" >    if (!subRoutes) {</span>
      // TODO: send to 404 - should never get here
<span class="cstat-no" title="statement not covered" >      console.error('TODO: route to 404');</span>
    } else {
&nbsp;
      // iterate through all the routes for a given key
      // and find the route that has the matching regex
      let found = <span class="cstat-no" title="statement not covered" >false;</span>
<span class="cstat-no" title="statement not covered" >      for (let i = 0; i &lt; subRoutes.length; i++) {</span>
<span class="cstat-no" title="statement not covered" >        if (subRoutes[i].regex.exec(url)) {</span>
          let ret = <span class="cstat-no" title="statement not covered" >this.parseParameters(subRoutes[i], url);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          if (typeof subRoutes[i].handler === 'function') {</span>
<span class="cstat-no" title="statement not covered" >            subRoutes[i].handler(ret);</span>
          } else {
<span class="cstat-no" title="statement not covered" >            subRoutes[i].renderRoute(ret);</span>
          }
&nbsp;
<span class="cstat-no" title="statement not covered" >          found = true;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >          break;</span>
        }
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      if (!found) {</span>
        // TODO: send to 404 - should never get here
<span class="cstat-no" title="statement not covered" >        console.error('TODO: route to 404');</span>
      }
    }
  },
&nbsp;
  /**
    Extracts a route's parameter given a route regular expression string
    and a url fragment.  A url fragment is a partial URL.
    @param routeRegex : the regular expression to match a route
    @param urlFragment : partial url to parse
    @return an array that represents the parse order
  */
  extractParameters(routeRegex, urlFragment) {
    let params = <span class="cstat-no" title="statement not covered" >routeRegex.exec(urlFragment).slice(1);</span>
<span class="cstat-no" title="statement not covered" >    return params.map(<span class="fstat-no" title="function not covered" >(p</span>aram, i) =&gt; {</span>
      // Don't decode the search params.
<span class="cstat-no" title="statement not covered" >      if (i === params.length - 1) <span class="cstat-no" title="statement not covered" >return param || null;</span></span>
<span class="cstat-no" title="statement not covered" >      return param ? decodeURIComponent(param) : null;</span>
    });
  }
}
&nbsp;
export default RouterUtils;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Sun Sep 24 2017 00:07:34 GMT-0400 (EDT)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
